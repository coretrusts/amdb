# ============================================================================
# AmDb 数据库配置文件
# ============================================================================
# 类似MySQL的my.cnf、PostgreSQL的postgresql.conf
# 所有配置项都可以通过此文件进行统一管理
# 
# 配置文件优先级：
# 1. 命令行参数（最高优先级）
# 2. 环境变量
# 3. 此配置文件
# 4. 代码默认值（最低优先级）
# ============================================================================

# ============================================================================
# [database] - 数据库基础配置
# ============================================================================
[database]
# 数据目录
# 说明：数据库文件存储的根目录
# 示例：./data/amdb 或 /var/lib/amdb
# 默认值：./data/amdb
data_dir = ./data/amdb

# 是否启用分片（支持大数据量）
# 说明：启用后，数据将按分片存储，支持千万级、上亿级数据
# 建议：生产环境建议启用，单机小数据量可禁用
# 默认值：true
enable_sharding = true

# 分片数量（默认256，可根据数据量调整）
# 说明：数据将被分成多少个分片存储
# 建议：
#   - 小数据量（<100万条）：64-128
#   - 中等数据量（100万-1亿条）：256-512
#   - 大数据量（>1亿条）：512-1024
# 默认值：256
shard_count = 256

# 单个文件最大大小（字节，默认256MB）
# 说明：单个SSTable文件的最大大小，超过后将自动分割
# 示例：268435456 = 256MB, 536870912 = 512MB
# 建议：根据磁盘性能和内存大小调整
# 默认值：268435456 (256MB)
max_file_size = 268435456

# ============================================================================
# [lsm] - LSM树配置
# ============================================================================
[lsm]
# LSM树MemTable最大大小（字节，默认10MB）
# 说明：内存表的最大大小，超过后将刷新到磁盘
# 示例：10485760 = 10MB, 20971520 = 20MB
# 建议：根据可用内存调整，建议为总内存的1-5%
# 默认值：10485760 (10MB)
memtable_max_size = 10485760

# LSM树每层最多SSTable数量
# 说明：每层最多保留多少个SSTable文件，超过后将触发压缩合并
# 建议：根据磁盘空间和性能需求调整
# 默认值：10
level_size_limit = 10

# 是否启用SkipList（当前禁用以确保稳定性）
# 说明：启用后使用跳表替代OrderedDict，提供O(log n)性能
# 注意：当前版本禁用以确保稳定性，后续版本将启用
# 默认值：false
enable_skip_list = false

# 是否启用Cython优化（当前禁用以确保稳定性）
# 说明：启用后使用Cython编译的优化版本，性能提升8-12倍
# 注意：需要先编译Cython扩展（运行 python setup_cython.py build_ext --inplace）
# 默认值：false
enable_cython = false

# ============================================================================
# [skip_list] - SkipList配置
# ============================================================================
[skip_list]
# SkipList最大层级
# 说明：跳表的最大层级，影响查找和插入性能
# 建议：16-32，层级越高性能越好但内存占用越大
# 默认值：16
max_level = 16

# SkipList最大大小（字节，默认10MB）
# 说明：跳表的最大大小，与MemTable大小一致
# 默认值：10485760 (10MB)
max_size = 10485760

# ============================================================================
# [batch] - 批量操作配置
# ============================================================================
[batch]
# 批量操作最大大小（条数，优化：测试显示3000性能最佳）
# 说明：单次批量写入的最大记录数
# 建议：
#   - 小批量（<1000）：适合实时写入场景
#   - 中批量（1000-3000）：适合批量导入场景（推荐）
#   - 大批量（>3000）：适合数据迁移场景，但可能影响响应时间
# 示例：1000, 3000, 5000
# 默认值：3000
max_size = 3000

# 版本管理批量操作最大大小（条数，优化：测试显示3000性能最佳）
# 说明：版本管理系统单次批量创建版本的最大记录数
# 建议：与batch.max_size保持一致
# 默认值：3000
version_max_size = 3000

# 跳过prev_hash计算的阈值（条数，超过此值将跳过prev_hash计算以提升性能）
# 说明：批量操作时，超过此阈值将跳过前一个版本的哈希计算，提升性能
# 建议：设置为batch.max_size的10-20%
# 默认值：300
skip_prev_hash_threshold = 300

# ============================================================================
# [performance] - 性能配置
# ============================================================================
[performance]
# 是否启用异步刷新
# 说明：启用后，MemTable刷新到磁盘的操作将在后台异步执行，不阻塞写入
# 建议：生产环境建议启用，可显著提升写入性能
# 默认值：true
enable_async_flush = true

# 是否启用预分配MemTable（减少内存分配开销）
# 说明：启用后，将在后台预分配MemTable，减少写入时的内存分配开销
# 建议：生产环境建议启用，可提升5-10%性能
# 默认值：true
enable_preallocated_memtable = true

# 刷新间隔（秒）
# 说明：MemTable自动刷新的时间间隔
# 建议：根据写入频率调整，高频写入建议0.5-1.0秒
# 默认值：1.0
flush_interval = 1.0

# 检查点间隔（秒）
# 说明：创建检查点的时间间隔，用于崩溃恢复
# 建议：根据数据重要性调整，重要数据建议30-60秒
# 默认值：60.0
checkpoint_interval = 60.0

# ============================================================================
# [network] - 网络配置
# ============================================================================
[network]
# 网络监听地址
# 说明：数据库服务器监听的IP地址
# 示例：
#   - 0.0.0.0：监听所有网络接口（默认，推荐）
#   - 127.0.0.1：仅监听本地回环接口（仅本地访问）
#   - 192.168.1.100：监听指定IP地址
# 默认值：0.0.0.0
host = 0.0.0.0

# 网络监听端口（使用不常用端口，避免与其他软件冲突）
# 说明：数据库服务器监听的端口号
# 示例：3888, 8888, 18888
# 注意：确保端口未被其他程序占用
# 默认值：3888
port = 3888

# 最大连接数
# 说明：同时支持的最大客户端连接数
# 建议：根据服务器性能和并发需求调整
# 默认值：100
max_connections = 100

# 超时时间（秒）
# 说明：客户端连接的超时时间
# 建议：根据网络环境调整，内网建议30秒，公网建议60秒
# 默认值：30.0
timeout = 30.0

# 是否启用SSL
# 说明：启用SSL/TLS加密传输
# 注意：启用后需要配置SSL证书
# 默认值：false
enable_ssl = false

# ============================================================================
# [cache] - 缓存配置
# ============================================================================
[cache]
# 是否启用缓存
# 说明：启用后，将缓存热点数据，提升读取性能
# 建议：生产环境建议启用
# 默认值：true
enable = true

# 缓存大小（字节，默认100MB）
# 说明：缓存的最大内存占用
# 示例：104857600 = 100MB, 524288000 = 500MB
# 建议：根据可用内存调整，建议为总内存的5-10%
# 默认值：104857600 (100MB)
size = 104857600

# 缓存类型（lru, lfu, fifo）
# 说明：缓存淘汰策略
#   - lru：最近最少使用（推荐，适合大多数场景）
#   - lfu：最不经常使用（适合访问模式稳定的场景）
#   - fifo：先进先出（适合访问模式随机的场景）
# 默认值：lru
type = lru

# 缓存过期时间（秒，0表示不过期）
# 说明：缓存数据的过期时间，0表示永不过期
# 示例：3600 = 1小时, 86400 = 1天
# 默认值：0（不过期）
ttl = 0

# ============================================================================
# [log] - 日志配置
# ============================================================================
[log]
# 日志级别（DEBUG, INFO, WARNING, ERROR, CRITICAL）
# 说明：日志记录的详细程度
#   - DEBUG：最详细，包含所有调试信息
#   - INFO：一般信息，适合生产环境（推荐）
#   - WARNING：仅警告和错误
#   - ERROR：仅错误
#   - CRITICAL：仅严重错误
# 建议：开发环境使用DEBUG，生产环境使用INFO
# 默认值：INFO
level = INFO

# 日志文件路径（空表示使用默认路径）
# 说明：日志文件的完整路径，空表示使用log.dir配置的目录
# 示例：/var/log/amdb/amdb.log
# 默认值：空（使用默认路径）
file = 

# 日志目录
# 说明：日志文件存储的目录
# 示例：./logs 或 /var/log/amdb
# 默认值：./logs
dir = ./logs

# 日志文件最大大小（字节，默认10MB）
# 说明：单个日志文件的最大大小，超过后将自动轮转
# 示例：10485760 = 10MB, 52428800 = 50MB
# 默认值：10485760 (10MB)
max_file_size = 10485760

# 日志备份文件数量
# 说明：保留的历史日志文件数量
# 建议：根据磁盘空间调整，建议5-10个
# 默认值：5
backup_count = 5

# 是否启用控制台输出
# 说明：是否将日志输出到控制台
# 建议：开发环境启用，生产环境禁用
# 默认值：true
enable_console = true

# 是否启用文件输出
# 说明：是否将日志写入文件
# 建议：生产环境建议启用
# 默认值：true
enable_file = true

# ============================================================================
# [security] - 安全配置
# ============================================================================
[security]
# 是否启用认证
# 说明：启用后，客户端连接需要提供认证信息
# 注意：区块链应用通常不需要用户认证，但可以启用操作审计
# 默认值：false
enable_auth = false

# 认证方法（token, password, certificate）
# 说明：认证方式
#   - token：使用JWT Token认证（推荐）
#   - password：使用用户名密码认证
#   - certificate：使用SSL证书认证
# 默认值：token
auth_method = token

# Token密钥（用于JWT等）
# 说明：JWT Token的签名密钥，建议使用强随机字符串
# 示例：使用 openssl rand -hex 32 生成
# 注意：生产环境必须设置，且妥善保管
# 默认值：空
token_secret = 

# 是否启用加密
# 说明：启用后，数据将以加密形式存储
# 注意：启用后需要设置encryption_key
# 默认值：false
enable_encryption = false

# 加密密钥
# 说明：数据加密的密钥，建议使用32字节的随机字符串
# 示例：使用 openssl rand -hex 32 生成
# 注意：生产环境必须设置，且妥善保管，丢失后无法恢复数据
# 默认值：空
encryption_key = 

# ============================================================================
# [audit] - 审计日志配置
# ============================================================================
[audit]
# 是否启用审计日志
# 说明：启用后，将记录所有数据库操作，用于区块链应用的审计和追溯
# 建议：区块链应用建议启用
# 默认值：true
enable = true

# 审计日志目录（空表示使用data_dir/audit_logs）
# 说明：审计日志文件存储的目录
# 示例：./audit_logs 或 /var/log/amdb/audit
# 默认值：空（使用data_dir/audit_logs）
log_dir = 

# ============================================================================
# [compression] - 压缩配置
# ============================================================================
[compression]
# 是否启用压缩
# 说明：启用后，SSTable文件将使用压缩算法存储，节省磁盘空间
# 建议：生产环境建议启用，可节省30-70%磁盘空间
# 默认值：true
enable = true

# 压缩类型（none, snappy, lz4）
# 说明：压缩算法
#   - none：不压缩（最快，但占用空间最大）
#   - snappy：Google Snappy算法（推荐，平衡性能和压缩比）
#   - lz4：LZ4算法（最快，但压缩比略低）
# 建议：大多数场景使用snappy
# 默认值：snappy
type = snappy

# ============================================================================
# [threading] - 多线程配置
# ============================================================================
[threading]
# 是否启用多线程
# 说明：启用后，将使用多线程并行处理，提升性能
# 建议：生产环境建议启用
# 默认值：true
enable = true

# 最大工作线程数（用于查询执行器、并行查询等）
# 说明：查询执行器和并行操作的最大线程数
# 建议：设置为CPU核心数，I/O密集型可设置为核心数的2-4倍
# 示例：4（4核CPU）, 8（8核CPU）
# 默认值：4
max_workers = 4

# 异步刷新线程数（用于MemTable异步刷新到磁盘）
# 说明：用于异步刷新MemTable的后台线程数
# 建议：根据磁盘I/O性能调整，SSD建议2-4个
# 默认值：2
async_flush_workers = 2

# 压缩合并线程数（用于SSTable压缩合并）
# 说明：用于SSTable压缩合并的后台线程数
# 建议：根据CPU核心数调整，建议2-4个
# 默认值：2
compaction_workers = 2

# 网络处理线程数（每个连接一个线程，建议设置为max_connections的10-20%）
# 说明：网络服务器处理客户端连接的线程数
# 建议：设置为max_connections的10-20%
# 示例：max_connections=100时，建议设置为10-20
# 默认值：10
network_workers = 10

# 是否启用并行批量写入（多线程并行处理批量写入，提升性能）
# 说明：启用后，大批量写入将使用多线程并行处理
# 建议：生产环境建议启用，可提升30-50%写入性能
# 默认值：true
enable_parallel_batch = true
